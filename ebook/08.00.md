# 8 設備管理

設備服務分為五個不同的類別:功能、網絡、系統、I/O安全的命令。這組命令可以用來獲取信息的設備性能和配置或設置設備配置。
[ONVIF DM WSDL]指定符合ONVIF標準的設備應支持設備管理服務。一組基本操作所需的設備管理服務，其他的操作是推薦或可選支持。列出了詳細規定下的命令描述。

# 8.1 功能

# 8.1.1 獲取WSDL URL

有可能某個端點請求URL,可以用來檢索完整的模式和WSDL定義的一個裝置。命令給返回一個URL可以獲取所有必要的產品特定的WSDL和模式定義的切入點。
[ONVIF DM WSDL]指定符合ONVIF標準的設備應支持設備管理服務。一組基本操作所需的設備管理服務，其他的操作是推薦或可選支持。列出了詳細規定下的命令描述。          

## 表9:獲取WSDL URL命令

消息名稱|描述
----|----
GetWsdlUrlRequest|這是一個空的消息。
GetWsdlUrlResponse|所請求的URL。<br/>xs:anyURI WsdlUrl [1][1]
故障代碼|描述
 |沒有具體命令的故障。

# 8.1.2 交換能力

可以要求任何端點設備使用功能交換請求響應操作的能力。該設備應通過GetCapabilities命令顯示其所有ONVIF兼容的功能。

功能列表包括引用的的地址（XADDR）在類中實現接口操作的服務。

## GetServices

返回一個集合的設備，服務和其現有能力。返回的功能響應消息是無類型允許未來添加服務,服務修改和服務功能。所有返回的服務功能應結構在所支持的設備由不同的命名空間。

一個設備要實現這個方法的實現GetServiceCapabilities ONVIF兼容的服務。為確保結構的GetServices響應功能,請參閱附件c .示例GetServices響應能力。

## 表10:獲取服務命令

消息名稱|描述
----|----
GetServicesRequest|這個消息包含一個請求的所有服務設備和可能為每個服務的功能。如果布爾IncludeCapability設置,那麽響應應包括服務功能。<br/>boolean IncludeCapability[1][1]
GetServicesResponse|響應消息的功能包含所請求的信息。<br/>tt:ServiceList [1][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

## GetServiceCapabilities

該命令返回的設備服務功能。如果設備支持GetServices方法，該服務應實現此方法。

## 表11:GetServiceCapabilities命令

消息名稱|描述
----|----
GetServiceCapabilitiesRequest|這是一個空的消息。
GetServiceCapabilitiesResponse|響應消息的功能包含所請求的設備能力使用層次化XML功能結構。
 |tds:DeviceServiceCapabilities Capabilities [1][1]
故障代碼|描述
 |沒有具體命令的故障。

## 表12:在GetServiceCapabilities命令的功能

類別|功能|描述
----|----|----
Network|IPFilter|如果設備支持IP過濾控制使用的命令在第8.2.18,8.2.19節，8.2.20節和8.2.21節中的指示。
 |ZeroConfiguration|如果設備支持零配置，按照第8.2.16和8.2.17節中的命令指示。
 |IPVersion6|如果設備支持IP版本6。
 |DynDNS|如果設備支持動態DNS根據第8.2.9和8.2.8節的配置。
 |Dot11Configuration|如果設備支持IEEE802.11配置的8.2.22節指定。
 |HostnameFromDHCP|是否檢索從DHCP主機支持的設備。
 |NTP|表示的最大數量的支持NTP服務器設備SetNTP命令的。
 |Dot1XConfigurations|表示設備所支持的最大數目的支持Dot1X配置，請參見8.4.7。
 |DHCPv6|表示支持IPv6的DHCP狀態。
System|DiscoveryResolve|如果設備解決請求的回應中所描述的第7.3.4節。
 |DiscoveryBye|如果設備發送再見消息，如在7.3.5節。
 |RemoteDiscovery|如果設備支持遠程發現7.4節中指定的支持。
 |SystemBackup|設備是否支持系統備份和恢複中指定的第8.3.3和第8.3.5節。
 |FirmwareUpgrade|設備是否支持固件升級8.3.10節中指定的部分。
 |SystemLogging|設備是否支持系統日誌檢索8.3.11節中指定的部分。
 |HttpSystemBackup|設備是否支持使用HTTP GET和POST進行系統備份和恢複。
 |HttpFirmwareUpgrade|設備是否支持使用HTTP POST固件升級。
 |HTTPSystemLogging|設備是否支持使用HTTP GET檢索系統日誌，請參見8.3.2節。
 |HTTPSupportInformation|設備是否支持使用HTTP獲取支持信息的檢索，請參見8.3.2節。
Security|TLS1.0|支持TLS 1.0。
 |TLS1.1|支持TLS 1.1。
 |TLS1.2|支持TLS 1.2。
 |OnboardKeyGeneration|如果設備支持板載密鑰生成和創建自簽名證書，如第8.4.8節中指定的指示。
 |AccessPolicyConfig|指示設備是否支持檢索和裝載設備的訪問控制策略，根據第8.4.1和第8.4.2節。
 |DefaultAccessPolicy|如果設備支持的默認訪問策略定義見5.12.1.1。
 |UsernameToken|如果設備支持ws - security UsernameToken身份驗證中定義[ws UsernameToken]。
 |HttpDigest|如果設備支持HTTP摘要認證。
 |X.509Token|如果設備支持ws - security X.09令牌[WS-X.509Token]。
 |SAMLToken|如果設備支持ws - security SAML令牌[WS-SAMLToken]。
 |KerberosToken|如果設備支持ws - security Kerberos令牌[WS-KerberosToken]。
 |RELToken|如果設備支持ws - security REL令牌[WS-RELToken]。
 |Dot1X|如果設備支持IEEE802.1X基於端口的網絡認證。
 |SupportedEAPMethod|列表的方法類型支持EAP。數字對應IANA[EAP-Registry]。
 |RemoteUserHandling|如果設備支持遠程用戶處理和相應的方法定義,根據8.4.21節和8.4.22節。

## GetCapabilities

這種方法提供了向後兼容的接口的基本功能。全套功能，請參閱GetServices的。

附件A介紹如何解釋的指示能力。除了地址，這個功能只體現在本說明書中的可選功能。

## 表13:獲取功能命令

消息名稱|描述
----|----
GetCapabilitiesRequest|這條消息包含設備能力的要求。客戶可以要求的所有功能，或只是一個特定的服務類別的能力。如果沒有指定類別的設備將返回所有的功能。<br/>tt:CapabilityCategory Category [0][unbounded]
GetCapabilitiesResponse|響應消息的功能包含所請求的設備功能使用層次化XML功能結構。<br/>tt:Capabilities Capabilities [1][1]
故障代碼|描述
env:Receiver <br /> ter:ActionNotSupported <br />  ter:NoSuchService|請求的WSDL服務類別是不支持的設備。

功能列表，請參閱附件A。

# 8.2 網絡

# 8.2.1 獲取主機名

該操作用於端點從設備獲取主機名。該設備將返回它的主機名配置通過GetHostname命令。

## 表14:GetHostname的命令

消息名稱|描述
----|----
GetHostnameRequest|這是一個空的消息。
GetHostnameResponse|此消息包含以下內容：<br/> * "FromDHCP":如果主機名是真正通過DHCP獲得(true)。<br/> * "Name":主機名。以防DHCP主機名經DHCP服務器獲得。<br/>xs:boolean FromDHCP [1][1]<br/>xs:token Name [0][1]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.2 設置主機名

此操作的設備上設置主機名。應盡可能將設備設置為主機名配置通過SetHostname命令。註意：調用SetDNS的可能會導致在覆蓋先前設置的主機名。

設備應當根據RFC1123第2.1節或者RFC952接受字符串格式化，其他字符串將被視為無效的字符串。

設備應盡量通過DHCP設置的HostnameFromDHCP能力，並提供一個空名稱字符串名稱檢索。

## 表15：SetHostname命令

消息名稱|描述
----|----
SetHostnameRequest |此消息包含以下內容：<br/> * “Name”：主機名。如果名字是一個空字符串主機名應該從DHCP獲取，否則應使用指定名稱。<br/>xs:token Name [1][1]
SetHostnameResponse |這是一個空的消息。
故障代碼|描述
env:Receiver <br /> ter:ActionNotSupported <br />  ter:NoSuchService|主機設備不能接受請求。

# 8.2.3 從DHCP設置主機名

此操作控制主機名稱是否應當從DHCP獲取。

設備應支持此命令，如果支持是通過HostnameFromDHCP功能。根據在設備上實現的變化可能只成在設備重啟後生效。

## 表16：SetHostnameFromDHCP命令

消息名稱|描述
----|----
SetHostnameFromDHCPRequest |此消息包含以下內容：<br/> * “FromDHCP”: 真正的主機名應當通過DHCP取得(true)。<br/>xs:boolean FromDHCP[1][1]
SetHostnameFromDHCPResponse |更改主機名設置需要重新啟動<br/>xs:boolean RebootNeeded [1][1]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.4 獲取DNS設置

此操作從設備得到的DNS設置。該設備將通過GetDNS命令返回其DNS配置。

## 表17:GetDNS命令

消息名稱|描述
----|----
GetDNSRequest |這是一個空的消息。
GetDNSResponse |此消息包含以下內容：<br/> * “FromDHCP”：如果通過DHCP獲得的DNS服務器(true)。<br> * “SearchDomain”:如果域(s)來搜索不是完全限定的主機名。<br/> * “DNSFromDHCP”: 通過DHCP獲得的情況下FromDHCP的DNS服務器列表等於true。這意味著該解決的地址在來自該領域DNSFromDHCP的DHCP的詳細配置狀態。<br/> * “DNSManual”: 手動指定的DNS服務器列表。<br/>xs:boolean FromDHCP [1][1]<br/>xs:token SearchDomain [0][unbounded]<br/>tt:IPAddress DNSFromDHCP [0][unbounded]<br/>tt:IPAddress DNSManual [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.5 設置DNS設置

此操作設置設備上的DNS設置。應盡可能通過SetDNS命令將設備設置DNS配置。

## 表18:設置DNS命令

消息名稱|描述
----|----
SetDNSRequest |此消息包含以下內容:<br/> * “FromDHCP”:如果DNS服務器是通過DHCP獲得(true)。<br/> * “SearchDomain”: 域(s)來搜索如果不是完全限定的主機名。<br/> * “DNSManual”:手動指定的DNS服務器列表。<br/>xs:boolean FromDHCP [1][1]<br/>xs:token SearchDomain [0][unbounded]<br/>tt:IPAddress DNSManual [0][unbounded]
SetDNSResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br />  ter:InvalidIPv6Address|所建議的IPv6地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br />  ter:InvalidIPv4Address|所建議的IPv4地址是無效的。

# 8.2.6 獲取NTP設置

此操作從設備得到的NTP設置。如果設備支持NTP，它應是可能得到的NTP服務器設置通過GetNTP命令。

## 表19:GetNTP命令

消息名稱|描述
----|----
GetNTPRequest |這是一個空的消息。
GetNTPResponse |此消息包含以下內容：<br/> * “FromDHCP”: 如果NTP服務器通過DHCP獲得(true)。<br/> * “NTPFromDHCP”: 通過DHCP獲得的情況下FromDHCP的NTP服務器列表等於true。這意味著，NTP服務器地址字段NTPFromDHCP來自DHCP和描述了當前的配置狀態。<br/> * “NTPManual”:手動給出NTP服務器列表。<br/>xs:boolean FromDHCP [1][1]<br/>tt:NetworkHost NTPFromDHCP [0][unbounded]<br/>tt:NetworkHost NTPManual [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.7 設置NTP設置

此操作設置的NTP設置在設備上。如果通過NTP功能支持NTP信號，應能通過SetNTP命令設置NTP服務器設置。

設備應接受字符串格式根據RFC 1123 第2.1節,其他的字符串將被視為無效的字符串。

NTP服務器列表的變更不影響時鐘模式DateTimeType。使用SetSystemDateAndTime激活NTP操作。

## 表19:SetNTP命令

消息名稱|描述
----|----
SetNTPRequest |此消息包含以下內容：<br /> * “FromDHCP”:如果NTP服務器是通過DHCP獲得(true)。<br /> * “NTPManual”:手動給出定的NTP服務器列表時，他們沒有通過DHCP獲得。<br /> xs:boolean FromDHCP [1][1] <br />tt:NetworkHost NTPManual [0][unbounded]
SetNTPResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br />  ter:InvalidIPv6Address|所建議的IPv6地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br />  ter:InvalidIPv4Address|所建議的IPv4地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br />  ter:InvalidDnsName|所建議的NTP服務器名稱是無效的。
env:Sender <br /> ter:InvalidArgVal <br />  ter:TimeSyncedToNtp|NTP服務器當前需要的DateTimeType。

# 8.2.8 獲取動態DNS設置

此操作從設備獲取的動態DNS設置。如果設備支持動態DNS指定的[RFC2136]和[RFC4702],應能通過GetDynamicDNS命令獲得類型、名稱和TTL。

## 表21:GetDynamicDNS命令

消息名稱|描述
----|----
GetDynamicDNSRequest |這是一個空的消息。
GetDynamicDNSResponse |此消息包含以下內容：
 | * “Type”:更新的類型。有三種可能的類型：設備沒有更新的欲望（NOUPDATE），該設備想要DHCP服務器更新（ServerUpdates）和設備本身是否更新（ClientUpdates）。 <br /> * “Name”: 在設備的情況下做的DNS名稱更新。 <br /> * “TTL”:存活時間。 <br/>  tt:DynamicDNSType Type [1][1] <br/> tt:DNSName Name [0][1] <br/> xs:duration TTL [0][1]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.9 設置動態DNS設置

在操作的設備上設置動態DNS設置。如果設備支持動態DNS指定的[RFC2136]和[RFC4702]，它應是可以通過SetDynamicDNS命令設置類型，名稱和TTL的。

## 表22:SetDynamicDNS命令

消息名稱|描述
----|----
SetDynamicDNSRequest |此消息包含以下內容：<br/> * “Type”:更新的類型。有三種可能的類型：設備沒有更新的欲望（NOUPDATE），該設備想要DHCP服務器更新（ServerUpdates）和設備本身是否更新（ClientUpdates）。 <br /> * “Name”: 在設備的情況下做的DNS名稱更新。 <br/> * “TTL”:存活時間。<br/>tt:DynamicDNSType Type [1][1]<br/>tt:DNSName Name [0][1]<br/>xs:duration TTL [0][1]
SetDynamicDNSResponse |這是一個空的消息。

# 8.2.10 獲取網絡接口配置

從此操作的設備得到一個網絡接口配置。該設備應當通過GetNetworkInterfaces NetworkInterface命令返回支持網絡接口配置設置所定義的類型。

## 表23:GetNetworkInterfaces命令

消息名稱|描述
----|----
GetNetworkInterfacesRequest |這是一個空的消息。
GetNetworkInterfacesResponse |這個消息包含設備網絡接口的數組。<br/>tt:NetworkInterface NetworkInterfaces [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.11 設置網絡接口配置

操作設備上的網絡接口配置設置。設備應通過SetNetworkInterfaces命令支持網絡支持的網絡接口的配置。

如果一個設備響應的RebootNeeded設置為false，該設備可以通過新的IP地址達到不進行進一步操作。客戶端應該知道，設備可能很短的一段時間不響應，直到信號可用性在新地址通過發現hello消息,見7.3.2。

如果設備響應與RebootNeeded設置為true，將進一步根據其以前的IP地址。通過SystemReboot命令重新啟動,該設置才會被激活。

## 表24:SetNetworkInterfaces命令

消息名稱|描述
----|----
SetNetworkInterfacesRequest |此消息包含以下內容：<br/> * “InterfaceToken”:令牌網絡接口的操作。<br/>“NetworkInterface”:網絡接口配置。<br/>tt:ReferenceToken InterfaceToken [1][1]<br/>tt:NetworkInterfaceSetConfiguration NetworkInterface [1][1]
SetNetworkInterfacesResponse |此消息包含以下內容：<br/> * “RebootNeeded “:表明如果改變網絡設置問題,需要重啟。<br/>xs:boolean RebootNeeded [1][1]
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv6Address|所建議的IPv6地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv4Address|所建議的IPv4地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidNetworkInterface|提供的網絡接口令牌不存在。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidMtuValue|MTU值是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidInterfaceSpeed|不支持建議的速度。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidInterfaceType|不支持建議的網絡接口類型。
env:Receiver <br /> ter:ActionNotSupported <br /> ter:InvalidDot11|不支持IEEE802.11配置。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidSecurityMode|不支持選定的安全模式。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidStationMode|不支持選定的電臺模式。
env:Sender <br /> ter:InvalidArgVal <br /> ter:MissingDot11|安全配置中缺少IEEE 802.11的值。
env:Sender <br /> ter:InvalidArgVal <br /> ter:MissingPSK|安全配置中缺少PSK值。
env:Sender <br /> ter:InvalidArgVal <br /> ter:MissingDot1X|安全配置中缺失或沒有IEEE802.1X的值。
env:Sender <br /> ter:InvalidArgVal <br /> ter:IncompatibleDot1X|安全配置中IEEE802.1X值的不兼容的網絡接口。
env:Receiver <br /> ter:ActionNotSupported <br /> ter:InvalidDHCPv6|不支持請求的狀態的DHCPv6模式。

# 8.2.12 獲取網絡協議

此操作從設備獲取所定義的網絡協議。該設備應支持GetNetworkProtocols命令返回配置網絡協議。

## 表25：GetNetworkProtocols命令

消息名稱|描述
----|----
GetNetworkProtocolsRequest |這是一個空的消息。
GetNetworkProtocolsResponse|這消息返回的數組定義協議支持的設備。有三個協議定義、HTTP、HTTPS和RTSP。以下參數可以檢索每個協議: <br/> * 端口 <br/> * 啟用/禁用 <br/>tt:NetworkProtocol NetworkProtocols [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.13 設置網絡協議

從操作配置的設備上定義網絡協議。設備應支持通過SetNetworkProtocols命令所定義的網絡協議的配置。

## 表26：SetNetworkProtocols命令

消息名稱|描述
----|----
SetNetworkProtocolsRequest |此消息配置一個或多個定義網絡設備所支持的協議。目前有三種定義的協議，HTTP，HTTPS和RTSP。以下參數可以被設置為每個協議:<br/> * 端口 <br/> * 啟用/禁用 <br/>tt:NetworkProtocol NetworkProtocols [1][unbounded]
SetNetworkProtocolsResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:ServiceNotSupported |所提供的網絡服務是不支持的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:PortAlreadyInUse |選定的端口已經被使用。
env:Receiver <br /> ter:ActionNotSupported <br /> ter:EnablingTlsFailed |該設備不支持TLS或TLS沒有適當的配置。

# 8.2.14 獲取默認網關

這個操作會從設備默認網關設置。該設備應支持GetNetworkDefaultGateway命令返回配置默認網關地址。

## 表27:GetNetworkDefaultGateway命令

消息名稱|描述
----|----
GetNetworkDefaultGatewayRequest |這是一個空的消息。
GetNetworkDefaultGatewayResponse |此消息包含以下內容:<br/> * IPv4Address”：默認IPv4網關地址<br/> * IPv6Address”：默認IPv6網關地址<br/>tt:IPv4Address IPv4Address [0][unbounded]<br/>tt:IPv6Address IPv6Address [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.15 設置默認網關

這個操作在設備上設置默認網關設置。該設備應當通過SetNetworkDefaultGateway命令支持配置默認網關。

## 表28:SetNetworkDefaultGateway命令

消息名稱|描述
----|----
SetNetworkDefaultGatewayRequest |此消息包含以下內容:<br/> * IPv4Address”：默認IPv4網關地址<br/> * IPv6Address”：默認IPv6網關地址<br/>tt:IPv4Address IPv4Address [0][unbounded]<br/>tt:IPv6Address IPv6Address [0][unbounded]
SetNetworkDefaultGatewayResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidGatewayAddress |所提供的網關地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv4Address |所建議的IPv4地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv6Address |所建議的IPv6地址是無效的。

# 8.2.16 獲取零配置

此操作從設備獲取的零配置。如果設備支持動態IP配置根據[RFC3927]，它應通過GetZeroConfiguration命令支持IPv4的零配置的地址和狀態回報

## 表29:GetZeroConfiguration命令

消息名稱|描述
----|----
GetZeroConfigurationRequest |這是一個空的消息。
GetZeroConfigurationResponse |此消息包含以下內容：<br/> * “InterfaceToken”: 令牌網絡接口<br/> * “Enabled”: 零配置是否已啟用<br/> * “Addresses”: 零配置的IPv4地址<br/> tt:ReferenceToken InterfaceToken [1][1]<br/> xs:boolean Enabled [1][1]<br/> tt:IPv4Addresses Address [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.17 設置零配置

此操作設置在設備上的零配置。如果設備支持動態IP配置時，應根據[RFC3927]通過SetZeroConfiguration命令支持配置IPv4的零配置地址和狀態。

## 表30:SetZeroConfiguration命令

消息名稱|描述
----|----
SetZeroConfigurationRequest |此消息包含以下內容：<br/> * “InterfaceToken”: 網絡接口的令牌上操作。<br/> * “Enabled”: 零配置是否已啟用。<br/>tt:ReferenceToken InterfaceToken [1][1]<br/>xs:boolean Enabled [1][1]
SetZeroConfigurationResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidNetworkInterface |提供的網絡接口令牌不存在

# 8.2.18 獲得IP地址過濾器

此操作從設備獲取的IP地址的過濾器設置。如果設備支持基於IP過濾規則（拒絕或接受的範圍內的IP地址）的設備訪問控制，設備應支持命令GetIPAddressFilter。

## 表31:GetIPAddressFilter命令

消息名稱|描述
----|----
GetIPAddressFilterRequest |這是一個空的消息。
GetIPAddressFilterResponse |此消息包含以下內容：<br/> * “Type”: 過濾器的集應拒絕或允許訪問。<br/> * “IPv4Address”:過濾的IPv4地址<br/> * “IPv6Address”:過濾的IPv6地址<br/>tt:IPAddressFilterType Type [1][1]<br/>tt:PrefixedIPv4Address IPv4Address [0][unbounded]<br/>tt:PrefixedIPv6Address IPv4Address [0][unbounded]
故障代碼|描述
 |沒有具體命令的故障。

# 8.2.19 設置IP地址過濾器

此操作在設備上設置的IP地址的過濾器設置。如果設備支持基於IP過濾規則（拒絕或接受的範圍內的IP地址）的設備訪問控制，設備應支持配置IP過濾規則通過SetIPAddressFilter命令的。

## 表32:SetIPAddressFilter命令

消息名稱|描述
----|----
SetIPAddressFilterRequest |此消息包含以下內容：<br/> * “Type”: 過濾器的集應拒絕或允許訪問。<br/> * “IPv4Address”:過濾的IPv4地址<br/> * “IPv6Address”:過濾的IPv6地址<br/>tt:IPAddressFilterType Type [1][1]<br/>tt:PrefixedIPv4Address IPv4Address [0][unbounded]<br/>tt:PrefixedIPv6Address IPv6Address [0][unbounded]
SetIPAddressFilterResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv6Address|所建議的IPv6地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv4Address|所建議的IPv4地址是無效的。

# 8.2.20 添加IP地址過濾

此操作添加一個IP地址過濾到設備。如果設備支持基於IP過濾規則（拒絕或接受的範圍內的IP地址）的設備訪問控制，設備應支持IP地址過濾通過AddIPAddressFilter命令添加。

設備的類型字段的值將被忽略。使用SetIPAddressFilter設置類型。

## 表33：AddIPAddressFilter命令

消息名稱|描述
----|----
AddIPAddressFilterRequest |此消息包含以下內容：<br/> * “Type”: 過濾器的集應拒絕或允許訪問。<br/> * “IPv4Address”:過濾的IPv4地址<br/> * “IPv6Address”:過濾的IPv6地址<br/>tt:IPAddressFilterType Type [1][1]<br/>tt:PrefixedIPv4Address IPv4Address [0][unbounded]<br/>tt:PrefixedIPv6Address IPv6Address [0][unbounded]
AddIPAddressFilterResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:IPFilterListIsFull |它不可能添加更多的IP過濾因為IP過濾列表是滿的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv6Address |所建議的IPv6地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv4Address |所建議的IPv4地址是無效的。

# 8.2.21 刪除IP地址過濾

此操作將從設備刪除IP地址過濾。如果設備支持基於IP過濾規則（拒絕或接受的範圍內的IP地址）的設備訪問控制，設備應支持IP地址過濾通過RemoveIPAddressFilter命令刪除。

設備的類型字段的值將被忽略。

## 表34:RemoveIPAddressFilter命令

消息名稱|描述
----|----
RemoveIPAddressFilterRequest |此消息包含以下內容：<br/> * “Type”: 在這個命令這個字段的值被忽略。<br/> * “IPv4Address”:過濾的IPv4地址<br/> * “IPv6Address”:過濾的IPv6地址<br/>tt:IPAddressFilterType Type [1][1]<br/>tt:PrefixedIPv4Address IPv4Address [0][unbounded]<br/>tt:PrefixedIPv6Address IPv6Address [0][unbounded]
RemoveIPAddressFilterResponse |這是一個空的消息。
故障代碼|描述
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv6Address |所建議的IPv6地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:InvalidIPv4Address |所建議的IPv4地址是無效的。
env:Sender <br /> ter:InvalidArgVal <br /> ter:NoIPv4Address |要刪除的IPv4地址不存在。
env:Sender <br /> ter:InvalidArgVal <br /> ter:NoIPv6Address |要刪除的IPv6地址不存在。

# 8.2.22 IEEE 802.11配置

在本節和小節的要求僅適用於IEEE 802.11支持通過其網絡Dot11Configuration功能的設備的信號。在本節和小節的術語“設備”被用於指示支持IEEE802.11的設備。

設備應支持IEEE802.11的配置，並須作為響應向GetNetworkInterfaces的方法返回ieee80211（71）為802.11接口（S）的IANA-IfTypes。

設備不得返回任何鏈接元素在GetNetworkInterfaces回複和應當忽略任何鏈接元素在SetNetworkInterfaces請求。

該設備應該支持,每個IEEE 802.11網絡接口可以有多個替代IEEE 802.11配置連接到它。

IEEE 802.11支持通過配置可選的IEEE802.11配置元素中獲取和設置網絡配置元素。下面的信息處理：

 * SSID
 * 站模式
 * 多個無線網絡配置
 * 安全配置

以下操作是用來幫助管理無線配置：

 * IEEE802.11功能
 * IEEE802.11狀態
 * 掃描IEEE802.11網絡

## SSID

該設備應支持的SSID的配置。

## 站模式

該設備應支持的基礎設施站模式。

該設備可能支持ad-hoc網絡站模式。所需的ad-hoc網絡站模式，包括手動配置的通道數量,超出了本規範的範圍,但允許設備,支持自組網站模式,規範允許選擇(和報告)這種模式。

## 多個無線網絡配置

每個IEEE802.11配置應確定一個別名（標識符）。別名應是唯一的一個網絡接口配置。客戶應在SetNetworkInterfaces請求提供別名。如果客戶端要更新現有的無線配置，應使用相同的別名。無線配置，包括別名，應只存在而這是一個網絡接口配置一部分。

對於可以使用設備多個替代IEEE802.11配置以能夠可選優先級值的優先級之間的，較高的值表示較高的優先級。如果有多個無線配置具有相同的優先級這些配置之間的順序是不確定的。

由設備實際使用的算法使IEEE 802.11網絡的優先級列表的IEEE 802.11配置是本規範的範圍之外。

## 安全配置

安全配置包含選定的安全模式，該模式下所需配置。支持以下安全模式：

 * None
 * PSK (Pre Shared Key) (WPA- and WPA2-Personal)
 * IEEE 802.1X-2004 (WPA- and WPA2-Enterpise)

配置WEP安全模式不在本文的討論範圍內,但允許設備形態支持WEP安全模式這個規範允許選擇(和報告)這種模式。

對於數據的保密性和完整性的設備，應當按照與[2007IEEE802.11-]規範，支持CCMP算法，該設備可能支持TKIP算法。

該算法既可以手動（CCMP，TKIP）或自動（任何）選擇。在手動模式選擇相同的算法應用於成對和分組密碼。能夠支持其他算法的“擴展”的值是可用的。

該設備應同時支持手動和自動模式選擇。

## None模式

該設備應支持“None”安全模式。

## PSK模式

設備應支持PSK安全模式。

為了盡量減少風險損害PSK裝置不能傳輸任何PSK到客戶端，並且不返回到調用操作的響應getnetworkinterfaces PSK。

增加無線配置與PSK安全模式下列規則適用：

 * 客戶端應包括PSK值在SetNetworkInterfaces請求
 * 該設備應提供了PSK值檢查，如果沒有這種裝置應該返回一個錯誤。

用於更新無線配置與PSK安全模式下列規則適用：

 * 如果客戶想保留的PSK值不應包括在setnetworkinterfaces PSK值請求
 * 設備接收一個SetNetworkInterfaces請求沒有PSK值應保留其PSK值

[IEEE 802.11-2007]標準的PSK應分配給STA一些波段的方法。ONVIF標準的安全策略應確保PSK充分保護。

## IEEE 802.1 x - 2004模式

設備應支持的IEEE 802.1X安全模式。對於更詳細的規定關於IEEE 802.1X-2004的安全模式請[IEEE 802.1X配置]

## 獲取Dot11的功能

此操作返回的IEEE802.11的功能，見表36。該設備應支持此操作。

## 表35:GetDot11Capabilities

消息名稱|描述
----|----
GetDot11CapabilitiesRequest |這是一個空的消息。
GetDot11CapabilitesResponse |tt:Dot11Capabilities Capabilities [1][1]
故障代碼|描述
env:Receiver <br /> ter:ActionNotSupported <br /> ter:InvalidDot11 |IEEE 802.11配置不支持。

## 表36：獲取IEEE802.11的功能

功能|描述
----|----
TKIP |指示如果設備支持TKIP算法。
ScanAvailableNetworks |指示設備支持的ScanAvailableIEEE802.11Networks操作。
MultipleConfiguration |指示設備是否支持多個可選的IEEE802.11的配置。
AdHocStationMode |指示如果設備支持臨時站模式。
WEP |指示設備是否支持WEP安全模式。

## 獲取IEEE802.11狀態

該操作返回一個無線網絡接口的狀態。這種設備應該支持這個命令。可以返回以下情況:

 * SSID (必須)
 * BSSID (應該)
 * Pair cipher (應該)
 * Group cipher (應該)
 * Signal strength (應該)
 * Alias of active wireless configuration (必須)

## 表37:GetDot11Status

消息名稱|描述
----|----
GetDot11StatusRequest |tt:ReferenceToken InterfaceToken [1][1]
GetDot11StatusResponse |tt:Dot11Status Status [1][1]
故障代碼|描述
env:Receiver <br/> ter:ActionNotSupported <br/> ter:InvalidDot11 |IEEE 802.11配置不支持。
env:Sender <br/> ter:InvalidArgVal <br/> ter:NotDot11 |該接口不是一個IEEE 802.11接口。
env:Sender <br/> ter:InvalidArgVal <br/> ter:InvalidNetworkInterface |提供的網絡接口令牌不存在。
env:Receiver <br/> ter:Action <br/> ter:NotConnectedDot11 |IEEE802.11網絡沒有連接。

## 掃描可用的IEEE802.11網絡

此操作返回在範圍內的設備的無線網絡列表。設備應該支持此操作。每個網絡可以返回以下狀態：

 * SSID (必須)
 * BSSID (應該)
 * Authentication and key management suite(s) (應該)
 * Pair cipher(s) (應該)
 * Group cipher(s) (應該)
 * Signal strength(s) (應該)

## 表38:ScanAvailableDot11Networks

消息名稱|描述
----|----
ScanAvailableDot11NetworksRequest |tt:ReferenceToken InterfaceToken [1][1]
ScanAvailableDot11NetworksResponse |tt:Dot11AvailableNetworks Networks [0][unbounded]
故障代碼|描述
env:Receiver <br/> ter:ActionNotSupported <br/> ter:InvalidDot11 |IEEE 802.11配置不支持。
env:Sender <br/> ter:InvalidArgVal <br/> ter:NotDot11 |該接口不是一個IEEE 802.11接口。
env:Sender <br/> ter:InvalidArgVal <br/> ter:InvalidNetworkInterface |提供的網絡接口令牌不存在。
env:Receiver <br/> ter:ActionNotSupported <br/> ter:NotScanAvailable |ScanAvailableDot11Networks不支持。

## 8.3 系統

###設備信息

此操作用於獲取設備的信息，比如設備的制造商，型號和固件版本。該設備應該支持通過GetDeviceInformation命令返回設備信息。

####表39：GetDeviceInformation命令
消息名|描述
----|----
GetDeviceInformationRequest|這是一個空消息
GetDeviceInformationResponse|響應獲取設備信息的消息，返回如下設備信息：<br />xs:string **Manufacturer** [1][1] <br />xs:string **Model** [1][1]<br />xs:string **FirmwareVersion** [1][1]<br />xs:string **SerialNumber** [1][1]<br />xs:string **HardwareId** [1][1]
錯誤代碼|描述
 |想不到相關的命令！

###備份

此操作用來檢索設備的系統配置文件。設備必須支持通過GetSystemBackup命令返回備份配置文件。The backup is returned with reference to a name and mime-type together with binary data。系統備份的精確格式在此規範那中沒有說明。

備份的配置文件通過MTOM來傳輸。

###表41：GetSystemBackup命令
消息名|描述
----|----
GetSystemUrisRequest|這是一個空消息
GetSystemBackupResponse|響應獲取系統備份的消息將返回包含系統備份的配置文件：<br />tt:BackupFile **BackupFiles** [1][unbounded]
錯誤代碼|描述
 |沒有找到相關命令

###恢複

此操作恢複先前從設備檢索到的系統備份的配置文件。該設備必須支持恢複備份配置文件的RestoreSystem的命令。備份配置文件的精確格式沒有在此規範里說明。如果設備支持該命令，那麽它將接受通過GetSystemBackup命令返回的備份文件。

備份的配置文件通過MTOM方式傳輸。

###表42：RestoreSystem命令
消息名|描述
----|----
RestoreSystemRequest|這個消息包含系統備份文件<br />tt:BackupFile **BackupFiles** [1][unbounded]
RestoreSystemResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:InvalidBackupFile|無效的備份文件

###啟動系統恢複

此操作使用HTTP POST機制啟動還原系統備份的配置數據。命令的響應包含一個上傳的備份文件的HTTP URL路徑。實際的恢複工作很快就被已經完成的HTTP POST操作所代替。設備應該支持通過StartSystemRestore命令來恢複數據。備份配置的精確格式不會在此規範中說明。

HTTP下的系統還原會經過下面的步驟：
1. 客戶端調用StartSystemRestore命令。

2. 設備服務響應上傳的URI。

3. 客戶端使用HTTP POST方式發送配置數據的上傳URI文件。

4. 服務器應用上傳的配置數據。如果有必要的話，重啟設備。

如果因為上傳文件無效而恢複失敗，那麽HTTP POST會響應“415 Unsupported Media Type”。如果由於設備錯誤而導致恢複失敗，HTTP POST會回應“500 Internal Server Error”。

HTTP POST請求的Content-Type頭信息值應該為“application/octet-stream”。

###表43：StartSystemRestore命令
消息名|描述
----|----
StartSystemRestoreRequest|這是一個空消息
StartSystemRestoreResponse|這個消息包含 * 會被上傳的系統配置文件路徑 * 可選的持續時間，表示在文件上傳多久之內，設備無法使用。<br />xs:anyURI **UploadUri [1][1]**<br />xs:duration **ExpectedDownTime [0][1]**
錯誤代碼|描述
 |沒有找到相關命令

###獲取系統日期和時間

該操作用來獲取設備系統的日期和時間。設備應該支持通過GetSystemDateAndTime命令返回夏時令設置、手動設置的日期和時間（如果適用的話）或者通過NTP獲取的時間（如果適用的話）。

為了保證向後兼容性，設備應該提供UTCDate時間信息，盡管它是可選的。


###表44：GetSystemDateAndTime命令
消息名|描述
----|----
GetSystemDateAndTime-Request|這是一個空消息
GetSystemDateAndTime-Response|消息包含設備的系統時間和日期<br />“DateTimeType”: 如果系統時間和日期通過手動或者NTP設置的。<br />“DaylightSavings”: 夏時令開啟或關閉<br />"TimeZone"：在第8.3節POSIX 1003.1中定義的時區<br />“UTCDateTime”: UTC時間和日期<br />“LocalDateTime”: 設備的本地時間和日期<br />tt:SetDateTimeType **DateTimeType** [1][1]<br />xs:boolean **DayLightSavings** [1][1]<br />tt:TimeZone **TimeZone** [0][1]<br />tt:DateTime **UTCDateTime** [0][1]<br />tt:DateTime **LocalDateTime** [0][1]
錯誤代碼|描述
 |沒有找到相關命令

###設置系統日期和時間

這項操作用來設置設備系統的日期和時間。該設備必須支持通過SetSystemDateAndTime命令來配置夏時令設置、手動設置時間（如果適用的話）或者指定NTP設置時間（如果適用的話）。A device shall consider a Timezone which is not formed according to the rules of [IEEE 1003.1] section 8.3 as invalid.

如果系統時間和日期是手動設置的，那麽客戶端請求應包含UTCDateTime或者LocalDateTime信息。

夏時令的標識應該設置為true來激活任何DST設置時區的字符串。


###表45：SetSystemDateAndTime命令
消息名|描述
----|----
SetSystemDateAndTime-Request|消息包含設備的時間和日期信息<br />“DateTimeType”: 如果系統時間是手動設置的或者NTP設置的<br />“DaylightSavings”: 如果在時區里面已經定義，將自動調整夏時令<br />"TimeZone":在第8.3節POSIX 1003.1中定義的時區<br />“UTCDateTime”: UTC時間和日期。如果DateTimeType是NTP，UTCDateTime就沒有作用。<br />tt:SetDateTimeType **DateTimeType** [1][1]<br />xs:boolean **DayLightSavings** [1][1]<br />tt:TimeZone **TimeZone** [0][1]<br />tt:DateTime **UTCDateTime** [0][1]
SetSystemDateAndTime-Response|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:InvalidTimeZone|指定了無效的時區
env:Sender<br />ter:InvalidArgVal<br />ter:InvalidDateTime|指定了無效的日期和時間
env:Sender<br />ter:InvalidArgVal<br />ter:NtpServerUndefined|無法把DateTimeType切換到NTP，因為NTP服務器是無效的

###出廠默認

此操作重載設備的參數到出廠默認值。該設備應該支持通過SetSystemFactoryDefault命令把軟件和硬件恢複到默認設置。The meaning of soft factory default is device product-specific and vendor-specific. The effect of a soft factory default operation is not fully defined. However, it shall be guaranteed that after a soft reset the device is reachable on the same IP address as used before the reset. 
這意味著基本的網絡設置，如IP地址，子網網關或DHCP設置無法通過軟件來重置。

###表46：SetSystemFactoryDefault命令
消息名|描述
----|----
SetSystemFactoryDefault-Request|此消息包含出廠默認執行的類型。<br />"Hard": 所有參數都設置為出廠默認值。<br />設備供應商的具體參數以外的所有參數都設置為出廠默認值<br />tt:FactoryDefaultType **FactoryDefault** [1][1]
SetSystemFactoryDefault-Response|這是一個空消息
錯誤代碼|描述
 |沒有找到相關命令

###固件升級

次操作是用來升級設備的固件版本。在成功發送了升級響應後，設備會重啟。設備應該支持通過UpgradeSystemFirmware命令來升級固件。固件數據的精確格式在此規範中沒有說明。

固件通過MTOM[MTOM]來傳輸

###表47：UpgradeSystemFirmware命令
消息名|描述
----|----
UpgradeSystemFirmware-Request|此消息包含用來升級的固件。固件升級選擇“soft”意味著所有參數保持它們的當前值。tt:AttachmentData **Firmware** [1][1]
UpgradeSystemFirmware-Response|此消息包含一個“消息”字符串。讓設備返回一個消息給客戶端，例如：“升級成功，設備會在X秒後重啟”<br />Xs:string **Message** [1][1]
錯誤代碼|描述
env:Sender<br />ter:InvalidArgs<br />ter:InvalidFirmware|固件是無效的，即不支持此設備
env:Receiver<br />ter:Action<br />ter:FirmwareUpgrade-Failed|固件升級失敗

###啟動固件升級
此操作用來啟動固件升級，使用HTTTP POST機制。命令的響應包含一個上傳的升級文件的HTTP URL路徑。實際的升級工作很快就被已經完成的HTTP POST操作所代替。設備應該支持通過StartFirmwareUpgrade命令來升級固件。固件數據的精確格式在此規範中沒有說明。

HTTP下的固件升級會經過下面的步驟：

1. 客戶端調用startfirmwareupgrade命令

2. 設備服務響應上傳的URI和可選的延遲值

3. 客戶端等待服務端指定的延遲

4. 客戶端使用HTTP POST方式發送固件鏡像到上傳服務端。

5. 服務器使用固件升級，然後重啟

如果因為上傳的文件無效而升級失敗，那麽HTTP POST會響應“415 Unsupported Media Type”。如果由於設備錯誤而導致升級失敗，HTTP POST會回應“500 Internal Server Error”。

HTTP POST請求的Content-Type頭信息值應該為“application/octet-stream”。


###表48：StartFirmwareUpgrade命令
消息名|描述
----|----
StartFirmwareUpgrade-Request|這是一個空消息
StartFirmwareUpgrade-Response|消息包含：<br />被上傳固件文件的URL路徑<br />可選的延遲時間；客戶端須等待這個時間後再啟動固件上傳<br />一個持續時間，表示在文件上傳固件後這個時間之內，設備無法使用。<br />xs:anyURI **UploadUri** [1][1]<br />xs:duration **UploadDelay** [0][1]<br />xs:duration **ExpectedDownTime** [0][1]
錯誤代碼|描述
 |沒有找到相關命令

###獲取系統日誌
此操作用於獲取單個設備的系統日誌。設備應支持通過GetSystemLog命令檢索系統日誌信息。系統日誌的精確格式沒有在此規範中說明。

通過MTOM[MTOM]或字符串傳輸系統的日誌信息。

###表49 GetSystemLog命令
消息名|描述
----|----
GetSystemLogRequest|此消息包含檢索到的系統日誌的類型。它定義了兩種被支持的日誌信息類型。<br />“System”: 系統日誌<br />"Access"：客戶端訪問日誌<br />tt:SystemLogType **LogType** [1][1]
GetSystemLogResponse|此消息包含請求的系統日誌信息。設備可選擇在附件中以二進制數據來返回系統日誌，也可以以普通字符串。<br />tt:AttachmentData **Binary** [0][1]<br />xs:string **String** [0][1]
錯誤代碼|描述
env:Sender<br />ter:InvalidArgs<br />ter:AccesslogUnavailable|沒有可用的訪問日誌
env:Sender<br />ter:InvalidArgs<br />ter:SystemlogUnavailable|沒有可用的系統日誌

###獲取支持信息

此操作用來從設備獲取任意的診斷信息。該設備應該支持通過GetSystemSupportInformation命令檢索診斷信息。診斷信息的精確格式不在規範中進行說明。

診斷信息作為一個附件或字符串通過MTOM[MTOM]方式來傳輸。

###表50：GetSystemSupportInformation命令
消息名|描述
----|----
GetSystemSupport-InformationRequest|這是一個空消息
GetSystemSupport-Information Response|消息包含支持信息。設備可以選擇二進制數據返回數據方式返回還是普通字符串返回信息。 <br />tt:AttachmentData **BinaryFormat** [0][1]<br />xs:string **StringFormat** [0][1]
錯誤代碼|描述
env:Sender<br />ter:InvalidArgs<br />ter:SupportInformation-Unavailable|沒有相關的支持信息

###重啟

此操作是用來重啟設備。設備接受到消息後馬上重啟。設備必須支持通過SystemReboot命令重啟。

###表51：SystemReboot命令
消息名|描述
----|----
SystemReboot|這是一個空消息
SystemRebootResponse|此消息包含一個消息字符串，設備響應一個消息給客戶端，比如：“在x秒之後將重啟”。<br />Xs:string **Message** [1][1]
錯誤代碼|描述
 |沒有相關的命令

###獲取範圍參數

此操作用來獲取設備的範圍參數。有兩種類型的範圍參數：

* 固定的

* 可配置的


固定範圍參數不能改變通過設備管理界面來修改，它是設備固件配置的部分永久設備特征。在響應獲取範圍參數操作返回結果的範圍列表內，已經指出範圍的類型。可配置的範圍參數可以被設置和添加操作，請參閱第8.3.14和8.3.15節。 該設備應支持通過GetScopes命令檢索搜索範圍參數， 由於一些範圍參數是強制性的，客戶端總是期望響應一個範圍列表。


###表52：GetScopes命令
消息名|描述
----|----
GetScopesRequest|這是一個空消息
GetScopesResponse|範圍響應消息中包含一個列表定義設備範圍的URI列表。另請參閱第7章的ONVIF範圍定義。<br />tt:Scope: **Scopes** [1][unbounded]
錯誤代碼|描述
env:Receiver<br />ter:Action<br />ter:EmptyScope|範圍列表是空的

###設置範圍參數

此操作設置設備參數範圍。範圍參數用於設備發現匹配探針的信息，請參見第7章。

此操作將替換所有現有配置的範圍參數（不固定參數）。如果想避免替換，應該使用範圍add命令來代替。設備應該支持通過SetScopes命令來設置發現範圍參數的配置。

###表53：SetScopes命令
消息名|描述
----|----
SetScopesRequest|設置的範圍包含了一系列的URI定義的設備範圍。請參考第七章。<br />Xs:anyURI: **Scopes** [1][unbounded]
SetScopesResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:OperationProhibited<br />ter:ScopeOverwrite|範圍參數覆蓋固定的設備範圍設置，命令被拒絕。
env:Receiver<br />ter:Action<br />ter:TooManyScopes|要求的範圍超出範圍的支持數量

###添加範圍參數

此操作用來向設備添加新的範圍參數配置。範圍參數用於設備發現匹配探針的信息，請參見第7章。該設備應支持通過AddScopes命令來添加發現範圍參數。


###表54：AddScopes命令
消息名|描述
----|----
AddScopesRequest|添加範圍包含一個被添加到現有配置的範圍列表的URI列表。請參見第7章。<br />xs:anyURI:**ScopeItem** [1][unbounded]
AddScopesResponse|這是一個空消息
錯誤代碼|描述
env:Receiver<br />ter:Action<br />ter:TooManyScopes|請求的範圍超出範圍的支持列表。

###移除範圍參數 

此操作將從設備中刪除範圍配置的範圍參數。範圍參數用於設備發現匹配探針的信息，請參見第7章。設備應該支持通過RemoveScopes命令來刪除發現範圍參數。

需要註意的是響應消息總是將匹配請求或者返回錯誤消息。響應的使用出於這個原因已棄用。

###表55：RemoveScopes命令
消息名|描述
----|----
RemoveScopesRequest|刪除範圍包含從設備範圍應刪除的URI列表。<br />xs:anyURI: **ScopeItem** [1][unbounded]
RemoveScopesResponse|範圍響應消息包含從設備範圍中已刪除的URI列表。<br />xs:anyURI: ScopeItem [0][unbounded]
錯誤代碼|描述
env:Sender<br />ter:OperationProhibited<br />ter:FixedScope|試圖刪除固定範圍參數，命令被拒絕。
env:Sender<br />ter:InvalidArgVal<br />ter:NoScope|嘗試刪除不存在的範圍。

###獲取發現模式

此操作用於獲取設備的發現模式。請參考7.2節的不同的設備發現模式的定義。該設備應支持通過GetDiscoveryMode命令檢索發現模式設置。

###表56：GetDiscoveryMode命令
消息名|描述
----|----
GetDiscoveryModeRequest|這是一個空消息
GetDiscoveryModeResponse|此消息包含當前發現模式設置，即可發現的或者不可發現的<br />tt:DiscoveryMode: **DiscoveryMode** [1][1]
錯誤代碼|描述
 |沒有相關的命令

###設置發現模式

此操作用來設置設備的發現模式。請參考7.2節的不同的設備發現模式的定義。該設備應支持通過GetDiscoveryMode命令配置發現模式設置。

###表57：SetDiscoveryMode命令
消息名|描述
----|----
SetDiscoveryModeRequest|此消息包含當前請求的發現模式設置，即可發現的或者不可發現的<br />tt:DiscoveryMode: **DiscoveryMode** [1][1]
SetDiscoveryModeResponse|這是一個空消息
錯誤代碼|描述
 |沒有相關的命令

###獲取遠程發現模式

此操作得到一個設備的遠程發現模式。請參考7.4節的遠程發現擴展的定義。支持遠程發現的設備應該支持通過GetRemoteDiscoveryMode命令檢索遠程發現模式。

###表58：GetRemoteDiscoveryMode命令
消息名|描述
----|----
GetRemoteDiscoveryMode-Request|這是一個空消息
GetRemoteDiscoveryMode-Response|此消息包含當前遠程發現模式設置。即可發現的或者不可發現的。<br />tt:DiscoveryMode: **RemoteDiscoveryMode** [1][1]
錯誤代碼|描述
 |沒有相關的命令

###設置遠程發現模式

此操作用來設置設備的遠程發現模式。請參考7.4節的遠程發現擴展的定義。支持遠程發現的設備應該支持通過GetRemoteDiscoveryMode命令設置遠程發現模式。

###表59：SetRemoteDiscoveryMode命令
消息名|描述
----|----
SetRemoteDiscoveryMode-Request|此消息包含請求的遠程發現模式設置，即可發現的或者不可發現的。<br />tt:DiscoveryMode: **RemoteDiscoveryMode** [1][1]
SetRemoteDiscoveryMode-Response|這是一個空消息
錯誤代碼|描述
 |沒有相關命令

###獲取遠程DP地址

此操作用來獲取設備的遠程DP地址或者地址。如果設備支持遠程發現，如在第7.4節規定的，設備應該支持通過GetDPAddresses命令索引遠程DP地址。

###表60：GetDPAddresses命令
消息名|描述
----|----
GetDPAddressesRequest|這是一個空消息
GetDPAddressesResponse|此消息包含設備配置的遠程DP地址或地址。如果沒有遠程DP地址配置，則返回一個空列表。<br />tt:NetworkHost: **DPAddress** [0][unbounded]
錯誤代碼|描述
 |沒有相關的命令

###設置遠程DP地址

此操作用來設置設備的遠程DP地址或者地址。如果設備支持遠程發現，如在第7.4節規定的，設備應該支持通過GetDPAddresses命令配置遠程DP地址。

###表61：SetDPAddresses命令
消息名|描述
----|----
SetDPAddressesRequest|此消息包含設備配置的遠程DP地址或地址。
SetDPAddressesResponse|這是一個空消息
錯誤代碼|描述
 |沒有相關的命令

### 8.4 安全

本節包含一組安全管理操作。這種操作對網絡攻擊十分敏感，為了不危及設備安全，應使用適當的授權級別。

###獲取訪問策略

訪問不同的服務子集，應該受到相應的權限限制。第5.12節給出了終點認證的先決條件。授權決定了接下來能使用的安全訪問策略。這個標準並沒有指定任何特定的策略描述格式或者安全策略，這是由設備制造商或系統供應商選擇策略和選擇的策略描述格式。然而，訪問策略（任意格式的）可以使用這個命令請求。如果設備支持訪問策略設置，那麽它應該支持這個命令。

###表62：GetAccessPolicy命令
消息名|描述
----|----
GetAccessPolicyRequest|這是一個空消息
GetAccessPolicyResponse|此消息包含請求的策略文件。<br />tt:BinaryData **PolicyFile** [1][1]
錯誤代碼|描述
env:Receiver<br />ter:Action<br />ter:EmptyPolicy|設備策略文件不存在或者文件為空

###設置安全策略

此命令設置設備的訪問安全策略（訪問安全策略的更多細節請參閱第8.4.1節的Get命令）。如果設備支持基於WS-安全認證的訪問策略設置，那麽它必須支持這個命令。

###表63：SetAccessPolicy命令
消息名|描述
----|----
SetAccessPolicyRequest|此消息中包含用來設置的政策文件。 <br />tt:BinaryData **PolicyFile** [1][1]
SetAccessPolicyResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgs<br />ter:PolicyFormat|由於未知的策略格式，無法設置策略

###獲取用戶

此操作列出註冊用戶以及用戶級別。設備應該支持檢索已註冊的設備用戶，以及他們通過GetUsers命令進行身份驗證。

###表64：GetUsers命令
消息名|描述
----|----
GetUsersRequest|這是一個空消息
GetUsersResponse|此消息中包含用戶列表和相應的憑證。每條記錄包括：<br />用戶名<br />用戶等級<br />也就是說用戶密碼不包括此響應中。<br />tt:User: **User** [0][unbounded]
錯誤代碼|描述
 |沒有找到相關的命令

###創建用戶

此操作用來創建新的設備用戶和相應的設備上進行身份驗證的憑據，請參見第5.12了解詳情。設備應該支持通過CreateUsers命令創建設備用戶和他們進行身份驗證的憑證。要麽所有的用戶都創建成功，要麽返回無法創建用戶的錯誤消息。

符合ONVIF標準的設備密碼長度應至少為28個字節，因為客戶端可以遵循密碼導出機制得到該長度為28字節的密碼，如5.12.2.1節所描述的

###表65：CreateUsers命令
消息名|描述
----|----
CreateUsersRequest|這個消息包含創建新用戶需要的參數。<br />每條用戶記錄包含：<br />用戶名<br />密碼<br />用戶等級<br />tt:User: **User** [1][unbounded]
CreateUsersResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:OperationProhibited<br />ter:UsernameClash|用戶名已存在
env:Sender<br />ter:OperationProhibited<br />ter:PasswordTooLong|密碼長度過長
env:Sender<br />ter:OperationProhibited<br />ter:UsernameTooLong|用戶名過長
env:Sender<br />ter:OperationProhibited<br />ter:Password|密碼太過簡單
env:Receiver<br />ter:Action<br />ter:TooManyUsers|超過了最大支持的用戶數
env:Sender<br />ter:OperationProhibited<br />ter:AnonymousNotAllowed|不被允許的匿名用戶級別
env:Sender<br />ter:OperationProhibited<br />ter:UsernameTooShort|用戶名過短

###刪除用戶

此操作用來刪除設備上的用戶。設備應該支持通過DeleteUsers命令刪除設備用戶和他們進行身份驗證的憑證。一個設備可以具有一個或多個固定的用戶不能被刪除，以確保本機的訪問。要麽所有的用戶都刪除成功，要麽返回無法刪除用戶的錯誤消息。

###表66：DeleteUsers命令
消息名|描述
----|----
DeleteUsersRequest|此消息包含要刪除的一個或多個用戶的名稱。
DeleteUsersResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:UsernameMissing|用戶名無法識別
env:Sender<br />ter:InvalidArgVal<br />ter:FixedUser|用戶不能被刪除

###設置用戶配置

此操作更新設備上一個或多個用戶的認證設置，查看第5.12節詳細。設備應支持通過setuser命令更新設備用戶和他們的憑據。要麽所有的變更請求被成功處理，要麽返回無法處理請求的失敗消息。

在密碼值被設置為可選的情況下，設備將考慮清楚密碼。如果設備不接受密碼長度為零，將返回"ter:PasswordTooWeak"的錯誤消息。

###表67：SetUser命令
消息名|描述
----|----
SetUserRequest|此消息中包含進行更新的用戶列表和相應的參數。<br />用戶名<br />密碼<br />用戶等級<br />tt:User: User [1][unbounded]
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:UsernameMissing|用戶名無法識別
env:Sender<br />ter:OperationProhibited<br />ter:PasswordTooLong|密碼長度過長
env:Sender<br />ter:OperationProhibited<br />ter:PasswordTooWeak|密碼太簡單
env:Sender<br />ter:OperationProhibited<br />ter:AnonymousNotAllowed|不允許的匿名用戶級別
env:Sender<br />ter:InvalidArgVal<br />ter:FixedUser|密碼或用戶級別無法修改

###IEEE802.1X配置

本說明書中定義了以下參數作為一組IEEE 802.1X的配置參數。

* 配置令牌
此參數表示一個參考IEEE802.1X配置參數的令牌，並且在[ONVIF架構]中定義為'Dot1XConfigurationToken'。這種命名為'dot1x'的約定，這實際上代表的IEEE 802.1x是用於更好的可讀性在生成的源代碼的架構元素。


* EAP身份

該參數表示客戶端連接到IEEE 802.1x網絡管理用戶名稱。

* EAP 方法

此參數表示的身份驗證方法。在[ONVIF模式]中這被定義為'EAP方法'。

* CA證書ID

此參數表示用於驗證服務器驗證的CA證書ID。在[ONVIF模式]中這被定義為CA證書ID。

* 個自選定的EAP方法的配置參數

根據選定的EAP方法，需要一些如下特定的參數：
[EAP-MD5], [EAP-PEAP/MSCHAP-V2], [EAP-TTLS types]：身份密碼可以驗證使用指定密碼的用戶（設備）。[EAP-MD5]方法不適合以802.11 (WPA-Enterprise)為目地的使用。

[EAP-TLS] : 客戶端證書ID是未了RADIUS服務器能使用指定的證書來驗證用戶（設備）


這些IEEE 802.1X參數將會被安全配置作為一個特定的網絡接口配置的一部分所引用。詳情請參閱8.2.11。

規範假設設備上的IEEE 802.1X配置將在IEEE 802.1X網絡管理範圍外來執行。在重新配置IEEE802.1X設置的情況，它也假定是802.1X網絡管理範圍外執行的。

請註意，在ONVIF2.0中對IEEE 802.1X的支持被限制在IEEE802.11接口。


###創建IEEE 802.1x配置

此操作將新創建設備的IEEE 802.1X配置參數。如果支持IEEE 802.1X意味著具備通過安全Dot1X標準的能力，那麽設備應該支持該命。
如果設備接收到這個請求已經存在配置令牌（Dot1XConfigurationToken）規範中，設備應響應‘ReferenceToken‘R錯誤，表示有一些配置沖突。

###表68：CreateDot1XConfiguration命令
消息名|描述
----|----
CreateDot1XConfigurationRequest|此消息包含：<br />tt:Dot1XConfiguration **Dot1XConfiguration**[1][1]
CreateDot1XConfigurationResponse|這是一個空消息
錯誤代碼|描述
env:Receiver<br />ter:ActionNotSupported<br />ter:EAPMethodNotSupported|建議的EAP方法不被支持
env:Receiver<br />ter:Action<br />ter:MaxDot1X|IEEE802.1X配置達到最大數量
env:Sender<br />ter:OperationProhibited<br />ter:CertificateID|無效的證書編號錯誤
env:Sender<br />ter:InvalidArgVal<br />ter:ReferenceToken|Dot1X配置已經存在
env:Sender<br />ter:InvalidArgVal<br />ter:InvalidDot1X|無效的IEEE 802.1X配置



###設置IEEE 802.1X配置

與CreateDot1XConfiguration命令試圖創建一個新的配置參數集不同的是，這個操作修改現有的IEEE802.1X的設備的配置參數集。如果支持IEEE 802.1X意味著具備通過安全Dot1X標準的能力，那麽設備應該支持該命


###表69：SetDot1XConfigurationRequest命令
消息名|描述
----|----
SetDot1XConfigurationRequest|此消息包含<br />tt:Dot1XConfiguration **Dot1XConfiguration**[1][1]
SetDot1XConfigurationResponse|這是一個空消息
錯誤代碼|描述
env:Receiver<br />ter:ActionNotSupported<br />ter:EAPMethodNotSupported|建議的EAP方法不被支持
env:Sender<br />ter:OperationProhibited<br />ter:CertificateID|無效的證書ID錯誤
env:Sender<br />ter:OperationProhibited<br />ter:ReferenceToken|無效的Dot1X配置令牌錯誤
env:Sender<br />ter:InvalidArgVal<br />ter:InvalidDot1X|無效的IEEE 802.1X配置


###獲取IEEE 802.1X配置

此操作是通過指定的配置令牌（Dot1X配置令牌）從設備取得一個IEEE802.1X配置參數。

如果支持IEEE 802.1X意味著具備通過安全Dot1X標準的能力，那麽設備應該支持該命。

無論在檢索的配置中的802.1X方法有沒有密碼，設備響應消息都不應該包含密碼元素。


###表70：GetDot1XConfiguration命令
消息名|描述
----|----
GetDot1XConfigurationRequest|消息內容包含：tt:ReferenceToken **Dot1XConfigurationToken**[1][1]
GetDot1XConfigurationResponse|消息包含：tt:Dot1XConfiguration **Dot1XConfiguration**[1][1]
錯誤代碼|描述
env:Sender<br />ter:OperationProhibited<br />ter:ReferenceToken|無效的Dot1X配置令牌錯誤


###獲取IEEE 802.1X配置

此操作從設備獲取所有的現有的IEEE802.1X配置參數集。該設備應響應所有的IEEE 802.1X配置，這樣客戶端就可以知道有多少個IEEE 802.1X配置，以及它們是如何配置的。

如果支持IEEE 802.1X意味著具備通過安全Dot1X標準的能力，那麽設備應該支持該命。

無論在檢索的配置中的802.1X方法有沒有密碼，設備響應消息都不應該包含密碼元素。

###表71：GetDot1XConfigurations命令
消息名|描述
----|----
GetDot1XConfigurationsRequest|這是一個空消息
GetDot1XConfigurationsResponse|消息內容包含tt: Dot1XConfiguration **Dot1XConfiguration**[0][unbounded]
錯誤代碼|描述
 |沒有相關的命令


###刪除IEEE 802.1X配置

此操作是從設備中刪除一個IEEE 802.1X配置參數。請求中的'Dot1X配置令牌'決定哪個配置應被刪除。如果支持IEEE 802.1X意味著具備通過安全Dot1X標準的能力，那麽設備應該支持該命


###表72：DeleteDot1XConfigurations命令
消息名|描述
DeleteDot1XConfigurationRequest|消息內容包含：tt:ReferenceToken **Dot1XConfigurationToken**[1][1]
DeleteDot1XConfigurationResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:OperationProhibited<br />ter:ReferenceToken|無效的Dot1X配置令牌錯誤
env:Receiver<br />ter:OperationProhibited<br />ter:ReferenceToken|不能刪除指定的IEEE 802.1X配置

###創建自簽名證書

該操作生成公/私密鑰對，也可以創建一個自簽名設備證書作為密鑰對生成的結果。創建證書使用合適的板載密鑰對生成機制。

如果設備支持板載密鑰對生成，支持TLS的設備應支持該證書創建命令。還有，如果設備支持板載密鑰對生成，支持IEEE 802.1X意味著具備通過the Security Dot1X標準的能力，那麽設備應該支持生成密鑰對的命令。證書和密鑰對使用證書ID識別。這些ID是所選擇的證書生成請求者或由設備（沒有給定的ID值的情況下）。


###表73：CreateCertificate命令
消息名|描述
----|----
CreateCertificateRequest|此消息包含（如適用）請求的證書ID和其他額外的請求參數：subject，valid not before和valid not after。<br />xs:token **CertificateID** [0][1]<br />xs:string **Subject** [0][1]<br />xs:dateTime **ValidNotBefore** [0][1]<br />xs:dateTime **ValidNotAfter** [0][1]
CreateCertificateResponse|此消息包含生成的自簽名證書<br />tt:Certificate **NvtCertificate** [1][1]
錯誤代碼|描述
env:Receiver<br />ter:Action<br />ter:KeyGeneration|公/私密鑰生成失敗

###獲取證書

此操作旨在獲取用於TLS驗證的所有服務端證書（包括自簽名證書），以及用於IEEE 802.1X驗證的客戶端證書。這個命令只列出該設備的TLS服務器證書和IEEE 802.1x客戶端證書（即不受信任的CA證書也不受信任的根證書）。返回的證書為二進制數據。支持TLS的設備應支持此命令；證書須用ASN.1編碼[X.681]，[X.682]，[X.683]DER[X.690]編碼規則。

###GetCertificates命令
消息名|描述
----|----
GetCertificatesRequest|這是一個空消息
GetCertificatesResponse|此消息包含一個設備證書的列表<br />tt:Certificate **NvtCertificate** [0][unbounded]
錯誤代碼|描述
 |沒有找到相關的命令

###獲取CA證書

CA證書被加載到設備中，用於以下兩種情況。一種是用於TLS服務功能中的TLS客戶端認證；另一種是用於IEEE 802.1X功能中的服務端身份認證。這項操作用來獲取所有設備中的CA證書。支持TLS客戶端認證或者IEEE 802.1X認證的設備應該支持這個命令。返回的證書應該使用ASN.1 [X.681], [X.682], [X.683] DER [X.690]編碼規則進行編碼。

###表75：GetCACertificates命令
消息名|描述
----|----
GetCACertificatesRequest|這是一個空消息
GetCACertificatesResponse|此消息包含一個CA證書的列表。<br />tt:Certificate **CACertificate** [0][unbounded]
錯誤代碼|描述
 |沒有找到相關的命令

###獲取證書狀態

此操作是針對TLS功能。此操作旨在獲取設備中TLS服務器證書的狀態（啟用或禁用）。支持TLS的設備應支持該命令。


###表76：GetCertificatesStatus命令
消息名|描述
----|----
GetCertificatesStatusRequest|這是一個空消息
GetCertificatesStatus-Response|此消息包含一個引用ID和狀態的設備服務端證書。狀態是一個布爾值（true為開啟，false為禁用）。<br />tt:CertificateStatus **CertificateStatus** [0][unbounded]
錯誤代碼|描述
 |沒有相關的命令

###設置證書狀態

此操作是針對TLS功能。此操作設置設備TLS服務器證書的狀態（啟用或禁用）。支持TLS的設備應該支持該命令。通常在同一時間只允許啟動一個設備服務端證書。

###表77：SetCertificatesStatus命令
消息名|描述
----|----
SetCertificatesStatusRequest|此消息包含ID和證書狀態（啟用或禁用）所引用的服務端證書列表。<br />tt:CertificateStatus **CertificateStatus** [0][unbounded]
SetCertificatesStatus-Response|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateID|未知的證書引用

###獲取證書請求

此操作是從設備請求一個PKCS#10證書簽名。返回的信息字段格式應該和指定的[PKCS＃10]或PEM編碼的[PKCS＃10]格式一致。為了讓這個命令正常工作，該設備必須已經有一個公鑰/私鑰對。它的密鑰對，應該由certificateid引用作為輸入參數中指定的參考描述。這CertificateID是指使用第8.4.8節中定義的CreateCertificate命令生成的密鑰對。

支持板載密鑰對生成，支持TLS或IEEE 802.1x使用客戶端證書的設備應該支持這個命令。

###表78：GetPkcs10Request命令
消息名|描述
----|----
GetPkcs10RequestRequest|此消息包含證書參考（密鑰對）和證書證書請求可選參數。這些屬性需要編碼為DER ASN.1對象。<br />xs:token **CertificateID** [1][1]<br />xs:string **Subject** [0][1]<br />xs:BinaryData **Attributes** [0][1]
GetPkcs10RequestResponse|此消息包含PKCS＃10請求數據結構。<br />tt:BinaryData **Pkcs10Request** [1][1]
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateID|無效的CertificateID值
env:Receiver<br />ter:Action<br />ter:Signature|PKCS＃10簽名創建失敗

###獲取客戶端證書狀態

此操作是針對TLS功能。此操作獲取TLS客戶端身份驗證的設備的狀態（啟用/禁用）。支持TLS的設備應支持該命令。

###表79：GetClientCertificateMode命令

消息名|描述
----|----
GetClientCertificateMode-Request|這是一個空消息
GetClientCertificateMode-Response|此消息包含該設備客戶端認證狀態，即開啟或者關閉。
錯誤代碼|描述
 |沒有相關的命令

###設置客戶端證書狀態

此操作是針對TLS功能。此操作設置設備TLS客戶端身份驗證的狀態（啟用或禁用）。支持TLS的設備應支持該命令。

###表80：SetClientCertificateMode命令
消息名|描述
----|----
SetClientCertificateMode-Request|此消息包含請求的設備客戶端的認證狀態，即啟用或禁用。<br />xs:boolean **Enabled** [1][1]
SetClientCertificateMode-Response|這是一個空消息
錯誤代碼|描述
env:Receiver<br />ter:InvalidArgVal<br />ter:ClientAuth|嘗試啟用客戶端身份驗證，但不支持或沒有配置客戶端身份驗證。 

###加載設備證書

TLS服務器證書或IEEE802.1X客戶端證書通過PKCS#10證書請求命令來創建，這兩種證書可以通過該命令（見第8.4.13節）加載到設備上。在請求中證書ID是必須的。該設備可以基於公共密鑰證書和證書的主題信息對已接收的證書進行排序。

在請求中的證書ID應該是客戶端期望的ID值。該設備應該首先掃描目前設備上的生成的密鑰對，以確定哪個是載入證書的通信密鑰對，然後建立證書與密鑰之間的聯系。

支持板載密鑰對生成以及支持TLS或IEEE 802.1X的設備應該支持此命令。

證書須用ASN.1編碼X.681，X.682，X.683 DER[X.690]編碼規則。

該命令適用於任何類型的設備，雖然由於歷史原因，參數名字被叫做NVTCertificate。


###表81：LoadCertificates命令
消息名|描述
----|----
LoadCertificatesRequest|此消息包含上傳的設備證書列表。<br />tt:Certificate **NVTCertificate** [1][unbounded]
LoadCertificatesResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateFormat|證書格式錯誤或設備不支持的格式
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateID|證書ID已經存在
env:Sender<br />ter:InvalidArgVal<br />ter:InvalidCertificate|無效的證書

###加載設備私有key相關的證書

可能有一些情況下，認證機構或其他同等的機構會創建一個沒有通過PKCS#10認證簽名的證書請求。 在這種情況下，證書將和自己的私鑰捆綁在一起。 這個命令將被用於這樣的用例場景。 是否給某個請求中的證書ID項設置一個客戶端期望的ID值是可選的。如果請求中沒有指定證書ID，設備可以選擇相應的ID。

此操作用來向設備導入公/私密鑰對。

證書須用ASN.1編碼X.681，X.682，X.683 DER[X.690]編碼規則。

不支持板載密鑰對生成和支持TLS或IEEE 802.1X使用客戶端證書的設備應該支持該命令。支持板載密鑰對生成的設備可能持此命令。支持此操作的設備的安全策略應該確保私鑰得到充分的保護。

###表82：LoadCertificateWithPrivateKey命令
消息名|描述
----|----
LoadCertificateWithPrivateKeyRequest|此消息包含一個導入的公鑰/私鑰對。<br />tt:CertificateWithPrivateKey<br />**CertificateWithPrivateKey**[1][unbounded]
LoadCertificateWithPrivateKeyResponse|這是一個空消息
錯誤代碼|描述
env: Sender<br />ter:InvalidArgVal<br />ter:CertificateFormat|證書格式錯誤或者設備不支持的設備
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateID|證書ID不存在
env: Sender<br />ter:InvalidArgVal<br />ter: KeysNotMatching|公鑰和私鑰不匹配

###獲取證書信息請求

此操作根據證書ID請求指定的證書信息。設備應回應“主題DN”，“密鑰用法”，“擴展密鑰用法”，“密鑰長度”，“版本”，“序號”，“簽名算法”和“合法性”相關證書信息，只要設備能從指定的證書檢索到這些的話。IssuerDN和SubjectDN應使用[RFC4514]的編碼規則。

支持TLS或IEEE 802.1X的設備應支持該命令。

###表83：GetCertificateInformation命令

消息名|描述
----|----
GetCertificateInformationRequest|此消息包含：<br />CertificateID：證書標識<br />xs: token CertificateID [1][1]
GetCertificateInformationResponse|此消息包含：<br />tt:CertificateInformation **CertificateInformation**[1][1]
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateID|無效的證書ID

###加載CA證書

此命令用於在必要時加載可信證書或者驗證受信任的根證書的副本。即TLS功能中的客戶端證書驗證或者IEEE 802.1X功能中的服務端證書驗證。

支持TLS或IEEE 802.1X的設備應支持此命令。設備應支持DER格式;還可能支持其他格式。該設備可基於公共密鑰證書（如果有的話）和主題信息對接收到的證書（如果有的話）進行排序。要麽全部成功加載CA證書，要麽返回無法加載證書的錯誤消息。

###表84 LoadCACertificates命令

消息名|描述
----|----
LoadCACertificatesRequest|消息包含被上傳的設備CA證書列表<br />tt:Certificate **CACertificate** [1][unbounded]
LoadCACertificatesResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateFormat|證書格式錯誤或設備不支持該格式
env:Sender<br />ter:InvalidArgVal<br />ter:CACertificateID|CA證書ID已經存在
env:Receiver<br />ter:OperationProhibited<br />ter:MaxCertificates|加載證書的數量超過了限制

###刪除證書

此操作將刪除一個證書或多個證書。設備也可以隨著刪除的證書一起刪除公/私密鑰對。支持TLS或者IEEE 802.1X的設備應該支持該命令來刪除一個或多個證書。要麽所有的證書被成功刪除，要麽返回刪除錯誤的消息。

###表85：DeleteCertificates命令
消息名|描述
----|----
DeleteCertificatesRequest|此消息通過CertificateID參數來確定刪除證書。xs:token **CertificateID**[1][unbounded]
DeleteCertificatesResponse|這是一個空消息
錯誤代碼|描述
env:Sender<br />ter:InvalidArgVal<br />ter:CertificateID|未知的證書參考
env:Receiver<br />ter:OperationProhibited<br />ter:CertificateID|無法刪除指定的證書

###獲取遠程用戶

此操作返回配置的遠程用戶（如果有的話）。標記為支持遠程用戶控制的設備，是通過了性能安全的用戶遠程操縱認證的，該設備支持這種操作。用戶是唯一有效的WS-UserToken 個人資料，或作為一個HTTP / RTSP用戶。


導出密碼的算法在第5.12.2.1中說明

###表86：GetRemoteUser命令
消息名|描述
----|----
GetRemoteUserRequest|這是一個空消息
GetRemoteUserResponse|此消息包含配置的遠程用戶（如果有的話）。返回的值是：<br />xs:string **Username** [1][1]<br />xs:boolean **UseDerivedPassword** [1][1]<br />註:設備永遠不會返回密碼字段在在remoteuser。<br />tt:RemoteUser: **RemoteUser** [0][1]
錯誤代碼|描述
env:Receiver<br />ter:ActionNotSupported<br />ter:NotRemoteUser|不支持遠程用戶處理

###設置遠程用戶

此操作用來設置遠程用戶。標記為支持遠程用戶控制的設備，是通過了性能安全的用戶遠程操縱認證的，該設備支持這種操作。用戶是唯一有效的WS-UserToken 個人資料，或作為一個HTTP / RTSP用戶。

設定的密碼始終是原來的（不是派生）的密碼。


當連接一個遠程設備時，UseDerivedPassword已經被設備設置為派生密碼。派生密碼的算法已經在第5.12.2.1中說明。

為了刪除遠程用戶，調用SetRemoteUser命令不應該有RemoteUser參數

###表87：SetRemoteUser命令
消息名|描述
----|----
SetRemoteUserRequest|此消息包含遠程用戶。可以設置的值：<br />xs:string **Username** [1][1]<br />xs:string **Password** [0][1]<br />xs:boolean **UseDerivedPassword** [1][1]<br />tt:RemoteUser: **RemoteUser** [0][1]
SetRemoteUserResponse|這是一個空消息
錯誤代碼|描述
env:Receiver<br />ter:ActionNotSupported<br />ter:NotRemoteUser|不支持遠程用戶處理

###獲取端點引用

客戶端可以要求設備服務端點引用地址屬性，可以得出口令相當於遠程用戶操作使用。該設備應支持GetEndpointReference命令返回設備服務端點引用的地址屬性。

###表88：GetEndpointReference命令
消息名|描述
----|----
GetEndpointReferenceRequest|這是一個空消息
GetEndpointReferenceResponse|請求的URL<br />xs:string **GUID** [1][1]
錯誤代碼|描述
 |沒有相關的命令

# 8.5 輸入/輸出(I/O)

本節中的命令保持向後兼容的目的。對於更廣泛的IO接口，請參閱ONVIF設備IO規格。
輸入/輸出（I / O）命令是用來控制狀態或觀察I / O端口的狀態。如果設備有I / O端口，那麽它應支持的I / O命令。

# 8.5.1 繼電器輸出

此操作獲取所有可用的繼電器輸出及其設置的列表。

## 表89：GetRelayOutputs 命令

消息名稱|描述
----|----
GetRelayOutputsRequest | 這是一個空消息。
GetRelayOutputsResponse | 該消息包含一個數組的繼電器輸出。tt:RelayOutput RelayOutputs [0][unbounded]
錯誤碼|描述
 | 沒有具體的錯誤碼

# 8.5.2 設置繼電器輸出配置

該操作為設置繼電器輸出的配置參數。

繼電器可工作在兩種繼電器模式：
•雙穩態 - 設置狀態後，繼電器仍保持在此狀態。
•單穩態 - 設置狀態後，繼電器返回到空閑狀態後指定的時間。

繼電器輸出的物理空閑狀態可通過設置IdleState為“open”或“closed”狀態來設置。

空閑狀態為“open”狀態表示繼電器打開時，繼電器狀態通過觸發命令設置為‘inactive’狀態（參見8.5.3節），和通過同樣的命令設置為‘active’來關閉。

空閑狀態為“closed”狀態表示繼電器閉合時，繼電器狀態通過觸發命令設置為‘inactive’狀態（參見8.5.3節），和通過同樣的命令設置為‘active’來打開。

“DelayTime”的屬性字段Duration參數描述了繼電器返回到空閑狀態之後的時間，如果它工作在單穩態模式。如果繼電器在雙穩態模式，該參數的值應該忽略。

## 表90：SetRelayOutputSettings 命令

消息名稱|描述
----|----
SetRelayOutputSettingsRequest  | 該消息包含： <br/> • “RelayToken”: Token reference to the requested relay output. <br/> • “RelayOutputSettings”: 繼電器設置參數 <br/> . <br/> tt:ReferenceToken RelayOutputToken [1][1] <br/> tt:RelayOutputSettings RelayOutputSettings [1][1]
SetRelayOutputSettingsResponse | 這是一個空消息
錯誤碼|描述
env:Sender <br/> ter:InvalidArgVal <br/> ter:RelayToken  | Unknown relay token reference.
env:Sender <br/> ter:InvalidArgVal <br/> ter:ModeError | 單穩態延時無效

# 8.5.3 觸發繼電器輸出

## 表91：SetRelayOutputState 命令

消息名稱|描述
----|----
SetRelayOutputStateRequest | 該消息包含： <br/> • “RelayToken”: Token reference to the requested relay output. <br/> • “LogicalState”: Trigger request, i.e., active or inactive. <br/> tt:ReferenceToken RelayOutputToken [1][1] <br/> tt:RelayLogicalState LogicalState [1][1]
SetRelayOutputStateResponse | 這是一個空消息
錯誤碼|描述
env:Sender <br/> ter:InvalidArgVal  <br/> ter:RelayToken | Unknown relay token reference.

# 8.6 輔助操作

本節描述的操作是用來管理輔助設備所支持的命令，控制如紅外（IR）燈，加熱器或雨刮器或連接到該設備的溫度計。

支持的命令可以通過AuxiliaryData參數來檢索，該參數來源於GetCapabilities命令的響應。使用此命令發送的命令應符合在AuxiliaryData響應所支持的命令之一。如果命令響應只列出irlampon命令，那麽SendAuxiliaryCommand的參數也應是irlampon，這可能表明是打開連接的紅外燈。

雖然這些輔助命令的名稱可以自由定義，命令以tt:前綴開頭，被保留來定義常用的命令，並且這些保留命令應該共享“tt:命令|參數”語法。

• tt:Wiper|On – 請求打開雨刮器.

• tt:Wiper|Off – 請求停止雨刮器.

• tt:Washer|On – 請求打開洗滌.

• tt:Washer|Off – 請求停止洗滌.

• tt:WashingProcedue|On – 請求打開洗滌程序.

• tt: WashingProcedue |Off – 請求停止洗滌程序.

標示了輔助服務能力的設備，將支持這些命令。

## 表92：發送輔助命令

消息名稱|描述
----|----
SendAuxiliaryCommandRequest | 該消息包含輔助命令。tt:AuxiliaryData AuxiliaryCommand[1][1]
SendAuxiliaryCommandResponse | 該響應包含輔助命令響應。tt:AuxiliaryData AuxiliaryCommandResponse[0][1]
錯誤碼|描述
----|----
env:Sender <br/> ter:InvalidArgVal <br/> ter:AuxiliaryDataNotSupported | 不支持AuxiliaryCommand請求

[上一章](08.05.03.md)|[繼續閱讀](09.00.md)
